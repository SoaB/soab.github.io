<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>UTF8 To BIG5 + bmfont - 札記</title><meta name=description content="BMF.C 程序說明文件
程式概述
本程式 bmf.c 是一個專門用於處理 Unicode（UTF-8）字串與 Big5 編碼之間轉換的 C 語言程式，同時具備從 Big5 編碼查詢對應點陣字體資料的功能。程式的核心設計目標是為了嵌入式系統或點陣顯示裝置（如 LCD、OLED 螢幕）提供中文字型的顯示支援。程式透過二分搜尋演算法高效地查詢 Unicode 到 Big5 的映射關係，並根據 Big5 編碼的特定區塊結構計算字型資料在字庫陣列中的偏移位置，最終輸出符合特定尺寸規格的點陣資料。
程式的設計採用了模組化架構，將字元編碼轉換與字型資料獲取分離，使得各個函式可以獨立重用。轉換流程從 UTF-8 字串出發，首先解析出每個 Unicode 碼點（codepoint），接著查詢對應的 Big5 編碼，最後根據 Big5 編碼的區塊分類從預先定義的字庫中提取點陣資料。這種設計方式不僅提高了轉換效率，也使得程式碼結構清晰易於維護。"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"SoaB","url":"https:\/\/soab.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/soab.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/soab.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/soab.github.io\/posts\/2026-01-17\/","name":"UTF8 to big5 bmfont"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"SoaB"},"headline":"UTF8 To BIG5 \u002b bmfont","description":"BMF.C 程序說明文件 程式概述 本程式 bmf.c 是一個專門用於處理 Unicode（UTF-8）字串與 Big5 編碼之間轉換的 C 語言程式，同時具備從 Big5 編碼查詢對應點陣字體資料的功能。程式的核心設計目標是為了嵌入式系統或點陣顯示裝置（如 LCD、OLED 螢幕）提供中文字型的顯示支援。程式透過二分搜尋演算法高效地查詢 Unicode 到 Big5 的映射關係，並根據 Big5 編碼的特定區塊結構計算字型資料在字庫陣列中的偏移位置，最終輸出符合特定尺寸規格的點陣資料。\n程式的設計採用了模組化架構，將字元編碼轉換與字型資料獲取分離，使得各個函式可以獨立重用。轉換流程從 UTF-8 字串出發，首先解析出每個 Unicode 碼點（codepoint），接著查詢對應的 Big5 編碼，最後根據 Big5 編碼的區塊分類從預先定義的字庫中提取點陣資料。這種設計方式不僅提高了轉換效率，也使得程式碼結構清晰易於維護。\n","inLanguage":"en","wordCount":450,"datePublished":"2026-01-17T14:05:47\u002b08:00","dateModified":"2026-01-17T14:05:47\u002b08:00","image":"https:\/\/soab.github.io\/images\/avatar.png","keywords":["c big5 utf8 bmpfont"],"mainEntityOfPage":"https:\/\/soab.github.io\/posts\/2026-01-17\/","publisher":{"@type":"Organization","name":"https:\/\/soab.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/soab.github.io\/images\/avatar.png","height":60,"width":60}}}</script><meta property="og:title" content="UTF8 To BIG5 + bmfont"><meta property="og:description" content="BMF.C 程序說明文件
程式概述
本程式 bmf.c 是一個專門用於處理 Unicode（UTF-8）字串與 Big5 編碼之間轉換的 C 語言程式，同時具備從 Big5 編碼查詢對應點陣字體資料的功能。程式的核心設計目標是為了嵌入式系統或點陣顯示裝置（如 LCD、OLED 螢幕）提供中文字型的顯示支援。程式透過二分搜尋演算法高效地查詢 Unicode 到 Big5 的映射關係，並根據 Big5 編碼的特定區塊結構計算字型資料在字庫陣列中的偏移位置，最終輸出符合特定尺寸規格的點陣資料。
程式的設計採用了模組化架構，將字元編碼轉換與字型資料獲取分離，使得各個函式可以獨立重用。轉換流程從 UTF-8 字串出發，首先解析出每個 Unicode 碼點（codepoint），接著查詢對應的 Big5 編碼，最後根據 Big5 編碼的區塊分類從預先定義的字庫中提取點陣資料。這種設計方式不僅提高了轉換效率，也使得程式碼結構清晰易於維護。"><meta property="og:image" content="https://soab.github.io/images/avatar.png"><meta property="og:url" content="https://soab.github.io/posts/2026-01-17/"><meta property="og:type" content="website"><meta property="og:site_name" content="SoaB"><meta name=twitter:title content="UTF8 To BIG5 + bmfont"><meta name=twitter:description content="BMF.C 程序說明文件
程式概述
本程式 bmf.c 是一個專門用於處理 Unicode（UTF-8）字串與 Big5 編碼之間轉換的 C 語言程式，同時具備從 Big5 編碼查詢對應點陣字體資料的功能。程式的核心設計目標是為了嵌入式系統或點陣顯示裝置（如 LCD、OLED 螢幕）提供中文字型的顯示支援。程式透過二分搜尋演算法高效地查詢 Unicode 到 Big5 的映射關係，並根據 Big5 …"><meta name=twitter:image content="https://soab.github.io/images/avatar.png"><meta name=twitter:card content="summary_large_image"><link href=https://soab.github.io/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.154.5"><link rel=alternate href=https://soab.github.io/index.xml type=application/rss+xml title=SoaB><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.6.0/css/all.css integrity=sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://soab.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://soab.github.io/css/highlight.min.css><link rel=stylesheet href=https://soab.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://soab.github.io/>SoaB</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li><a title=Archives href=/archives/>Archives</a></li><li><a title=About href=/page/about/>About</a></li><li><a title=Tags href=/tags>Tags</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title=SoaB href=https://soab.github.io/><img class=avatar-img src=https://soab.github.io/images/avatar.png alt=SoaB></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>UTF8 To BIG5 + bmfont</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on January 17, 2026
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;3&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;450&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;SoaB</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><h1 id=bmfc-程序說明文件>BMF.C 程序說明文件</h1><h2 id=程式概述>程式概述</h2><p>本程式 <code>bmf.c</code> 是一個專門用於處理 Unicode（UTF-8）字串與 Big5 編碼之間轉換的 C 語言程式，同時具備從 Big5 編碼查詢對應點陣字體資料的功能。程式的核心設計目標是為了嵌入式系統或點陣顯示裝置（如 LCD、OLED 螢幕）提供中文字型的顯示支援。程式透過二分搜尋演算法高效地查詢 Unicode 到 Big5 的映射關係，並根據 Big5 編碼的特定區塊結構計算字型資料在字庫陣列中的偏移位置，最終輸出符合特定尺寸規格的點陣資料。</p><p>程式的設計採用了模組化架構，將字元編碼轉換與字型資料獲取分離，使得各個函式可以獨立重用。轉換流程從 UTF-8 字串出發，首先解析出每個 Unicode 碼點（codepoint），接著查詢對應的 Big5 編碼，最後根據 Big5 編碼的區塊分類從預先定義的字庫中提取點陣資料。這種設計方式不僅提高了轉換效率，也使得程式碼結構清晰易於維護。</p><h2 id=依賴與編譯需求>依賴與編譯需求</h2><p>本程式的運作依賴於兩個外部標頭檔案，這些檔案必須與 <code>bmf.c</code> 放置在同一專案目錄下或正確配置包含路徑。<code>lili/big5_sort_table.h</code> 檔案包含名為 <code>mapping</code> 的結構陣列，該陣列儲存了 Unicode 與 Big5 編碼之間的對應關係，每個元素為 <code>Big5Mapping</code> 結構，內含 <code>unicode</code> 和 <code>big5</code> 兩個欄位。<code>lili/bmFont.h</code> 檔案則包含各種字型資料陣列，如 <code>spcFont</code>（特殊符號區）、<code>spcFsupp</code>（擴充符號區）、<code>stdFont</code>（常用字區）以及 <code>ascFont</code>（ASCII 字元區），這些陣列以連續記憶體的方式儲存點陣字型的位元資料。</p><p>編譯本程式時，需要確保編譯器支援 C99 標準或更新版本，因為程式使用了如 <code>uint32_t</code>、<code>size_t</code> 等標準類型定義，以及指定陣列大小的初始化方式。編譯指令範例如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcc -std<span style=color:#f92672>=</span>c99 -o bmf bmf.c
</span></span></code></pre></div><p>執行編譯後產生的可執行檔案，即可測試程式功能。若編譯過程中出現找不到標頭檔案的錯誤，請檢查 <code>lili</code> 目錄是否存在於專案根目錄，或透過 <code>-I</code> 參數指定額外的包含路徑。</p><h2 id=函式詳細說明>函式詳細說明</h2><h3 id=比較函式cmp_mapping>比較函式（cmp_mapping）</h3><p><code>cmp_mapping</code> 函式專門設計作為二分搜尋（bsearch）的比較回呼函式，其功能是比較兩個 <code>Big5Mapping</code> 結構的 <code>unicode</code> 欄位大小。函式接收兩個指向常數的指標作為參數，分別代表搜尋鍵與陣列元素。實作方式採用了現代 C 語言的簡潔寫法，透過 <code>((ua > ub) - (ua &lt; ub))</code> 的運算式直接返回 -1、0 或 1 作為比較結果，這種寫法不僅程式碼精簡，且經過編譯器最佳化後效率與傳統的 if-else 寫法相當。</p><p>該函式的設計遵循了標準庫函式對比較函式的慣例要求，確保與 <code>bsearch</code> 配合使用時能夠正確執行二分搜尋演算法。在實際應用中，由於映射表通常包含數萬筆資料，二分搜尋的時間複雜度為 O(log N)，能夠在毫秒等級的時間內完成查詢，這對於需要即時轉換字元的顯示系統而言至關重要。</p><h3 id=unicode-到-big5-查表函式lookup_big5>Unicode 到 Big5 查表函式（lookup_big5）</h3><p><code>lookup_big5</code> 函式是整個轉換流程的核心樞紐，負責將輸入的 Unicode 碼點轉換為對應的 Big5 編碼。函式首先對 ASCII 範圍（0x00-0x7F）進行快速處理，因為這些字元在兩種編碼中表示方式相同，可直接返回原值。對於 ASCII 範圍外的字元，函式會構造一個搜尋鍵結構，並呼叫標準庫的 <code>bsearch</code> 函式在預先排序好的映射表中進行二分搜尋。</p><p>搜尋成功時，函式返回映射表中對應的 Big5 編碼；若搜尋失敗，則返回預設值 <code>0xA1BC</code>，該值對應 Big5 編碼中的全形空格或方塊字元，用於表示無法轉換的不明字元。這種容錯設計確保了即使遇到映射表中未收錄的罕用字，程式仍能維持運作而不會崩潰。值得注意的是，映射表 <code>mapping</code> 的大小由 <code>mapping_size</code> 變數定義，該變數應在 <code>lili/big5_sort_table.h</code> 中正確定義。</p><h3 id=utf-8-解析函式next_utf8_codepoint>UTF-8 解析函式（next_utf8_codepoint）</h3><p><code>next_utf8_codepoint</code> 函式專門用於解析 UTF-8 編碼字串中的下一個 Unicode 碼點。函式接收兩個指標參數：第一個是指向字元指標的指標（用於更新解析位置），第二個是字串結束位置的指標（用於邊界檢查）。解析邏輯依據 UTF-8 編碼的位元模式規律，支援 1-byte 到 4-byte 的各種編碼長度。</p><p>對於 1-byte 情況（ASCII 字元），直接返回該位元組的值。對於 2-byte 到 4-byte 的情況，函式會驗證位元組序列的合法性，檢查各個位元組是否符合 UTF-8 的前綴模式（如 <code>110xxxxx</code> 表示 2-byte），並在確認序列完整且有效後，透過位元運算重組各個位元組中的有效資料位元，形成完整的 21-bit Unicode 碼點。若遇到無效的 UTF-8 序列（如預期長度不足或格式錯誤），函式會跳過第一個位元組並返回 Unicode 替換字元（U+FFFD，0xFFFD），這是 UTF-8 標準規定的標準處理方式。</p><h3 id=utf-8-轉-big5-轉換函式utf8_to_big5>UTF-8 轉 Big5 轉換函式（utf8_to_big5）</h3><p><code>utf8_to_big5</code> 函式作為高階轉換介面，將輸入的 UTF-8 字串批量轉換為 Big5 編碼陣列。函式參數包括輸入字串指標、要處理的位元組數量上限、輸出緩衝區指標以及輸出緩衝區可容納的元素數量。這種設計允許呼叫者控制記憶體配置，避免緩衝區溢出的風險。</p><p>轉換過程中，函式會持續呼叫 <code>next_utf8_codepoint</code> 解析下一個碼點，並將解析結果傳遞給 <code>lookup_big5</code> 取得對應的 Big5 編碼。轉換會在以下任一條件發生時停止：輸入字串結束、遇到空字元、達到輸出緩衝區容量上限，或解析到無效的 UTF-8 序列（碼點為 0）。函式最終返回成功轉換的字元數量，呼叫者可以依此判斷轉換是否完整完成。</p><h3 id=字型資料獲取函式getbmfontbuf>字型資料獲取函式（GetBmfontBuf）</h3><p><code>GetBmfontBuf</code> 函式是程式中最為複雜的部分，負責根據 Big5 編碼計算並提取對應的點陣字型資料。函式的核心邏輯是基於 Big5 編碼的區塊結構特性：Big5 編碼由高位元組（Hi Byte）和低位元組（Low Byte）組成，高位元組範圍通常為 0x81-0xFE，但標準字庫從 0xA1 開始；低位元組則分為兩個區段，分別是 0x40-0x7E（63 個字元）和 0xA1-0xFE（94 個字元），每個高位元組對應的區塊共計 157 個字元。</p><p>函式首先根據輸入的 Big5 編碼值判斷其所屬區塊：區塊一（0xA140-0xA3BF）對應特殊符號區，使用 <code>spcFont</code> 字庫；區塊二（0xC6A1-0xC8D3）對應擴充符號區，使用 <code>spcFsupp</code> 字庫；區塊三（0xA440-0xC67E 和 0xC940-0xF9FE）對應常用字和次常用字區，使用 <code>stdFont</code> 字庫；其他情況則處理為 ASCII 字元。</p><p>確定區塊後，函式會計算字元在字庫陣列中的線性偏移位置。計算方式首先將高位元組減去該區塊的起始值（如 0xA1、0xC6、0xA4 等），乘以頁大小（157），再加上低位元組在該頁中的索引位置。低位元組索引的計算需要區分兩個子區段，因為 0x40-0x7E 和 0xA1-0xFE 在連續陣列中是連續排列的。最終偏移量乘以每個字元的位元組大小（FONT_SIZE_FULL = 72，表示 24x24 點的圖像），得到精確的記憶體偏移地址。函式最後使用 <code>memcpy</code> 直接複製字型資料到輸出緩衝區，避免了逐位元組複製的低效率問題。</p><h3 id=點陣顯示函式printbmfont-與-printbmfontasc>點陣顯示函式（PrintbmFont 與 PrintbmFontAsc）</h3><p><code>PrintbmFont</code> 和 <code>PrintbmFontAsc</code> 函式用於在文字終端機上以視覺化方式顯示點陣字型資料。這兩個函式主要作為除錯和測試用途，但在某些嵌入式環境中也可直接用於字型驗證。<code>PrintbmFont</code> 處理全形字元，採用 24x24 的點矩陣佈局，每列使用 3 個位元組（24 位元）；<code>PrintbmFontAsc</code> 處理半形 ASCII 字元，採用 16x24 的點矩陣佈局，每列使用 2 個位元組（16 位元）。</p><p>兩個函式的實作邏輯相似：首先遍歷字型緩衝區的每一列，讀取每個位元組後再逐一檢查其 8 個位元。若某一位元為 1，則在終端機輸出 <code>"##"</code> 兩個井字元號；若為 0，則輸出兩個空白。這種表示方式使得字型的輪廓在終端機上清晰可見。輸出時每列結束會換行，每個字元顯示完畢會輸出分隔線以便於區分相鄰字元。</p><h2 id=應用場景與方向>應用場景與方向</h2><p>本程式最直接的應用場景是嵌入式系統中的中文字型顯示。許多嵌入式裝置（如工業控制器、智慧型家電、儀器儀表等）需要顯示使用者介面資訊，而傳統的點陣顯示器（如 128x64 OLED、LCD 模組）儲存空間有限，無法預載完整的中文字型圖庫。本程式提供的轉換機制允許嵌入式系統僅儲存必要的 Big5 字型資料，並在需要顯示時即時從 UTF-8 輸入轉換為點陣格式，這種「隨需載入」的方式大幅降低了記憶體需求。</p><p>另一個重要的應用方向是字型轉換工具的開發。開發者可以基於本程式的核心函式（<code>utf8_to_big5</code> 和 <code>GetBmfontBuf</code>），建構批量字型轉換工具，將文字檔案或字串轉換為特定格式的點陣資料陣列，用於預先燒錄到顯示器的快閃記憶體中。此外，，程式的架構也具有良好的擴充性，若要支援其他字型尺寸（如 16x16、32x32）或編碼格式（如 GB2312、GBK），僅需修改相關的常數定義和字庫包含，核心轉換邏輯可以保持不變。</p><p>在文字處理領域，本程式可作為編碼轉換的基礎元件。例如，需要將 UTF-8 編碼的使用者輸入轉換為 Big5 編碼以相容傳統系統的場景，或需要從 Big5 編碼的資料檔案中提取可讀文字並統一為 UTF-8 編碼的場景，都可以利用本程式的查表機制實現。</p><h2 id=程式使用範例>程式使用範例</h2><p>以下範例展示如何使用本程式的主要功能。此範例已包含在程式的 <code>main</code> 函式中，編譯執行後可觀察輸出結果。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 假設相關標頭檔案已正確包含
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>uint16_t</span> <span style=color:#a6e22e>lookup_big5</span>(<span style=color:#66d9ef>uint32_t</span> unicode);
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>size_t</span> <span style=color:#a6e22e>utf8_to_big5</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> utf8_str, <span style=color:#66d9ef>size_t</span> max_utf8_bytes,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint16_t</span><span style=color:#f92672>*</span> out_buf, <span style=color:#66d9ef>size_t</span> out_buf_size);
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>GetBmfontBuf</span>(<span style=color:#66d9ef>uint16_t</span> big5, <span style=color:#66d9ef>uint8_t</span><span style=color:#f92672>*</span> buf);
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>PrintbmFont</span>(<span style=color:#66d9ef>uint8_t</span><span style=color:#f92672>*</span> buf);
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>PrintbmFontAsc</span>(<span style=color:#66d9ef>uint8_t</span><span style=color:#f92672>*</span> buf);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define FONT_SIZE_FULL 72
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;乂幹測試Abc！&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint16_t</span> big5_buf[<span style=color:#ae81ff>256</span>] <span style=color:#f92672>=</span> { <span style=color:#ae81ff>0</span> }; 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint8_t</span> bmBuf[FONT_SIZE_FULL] <span style=color:#f92672>=</span> { <span style=color:#ae81ff>0</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// UTF-8 轉 Big5
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>size_t</span> count <span style=color:#f92672>=</span> <span style=color:#a6e22e>utf8_to_big5</span>(text, <span style=color:#a6e22e>strlen</span>(text), big5_buf, <span style=color:#ae81ff>256</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;原字串: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, text);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;轉換個數: %zu</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, count);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Big5 Codes: &#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>size_t</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> count; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%04X &#34;</span>, big5_buf[i]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 取得並印出點陣字
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>size_t</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> count; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>memset</span>(bmBuf, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>sizeof</span>(bmBuf));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>GetBmfontBuf</span>(big5_buf[i], bmBuf);
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Char Code: 0x%04X</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, big5_buf[i]);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (big5_buf[i] <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x80</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PrintbmFontAsc</span>(bmBuf);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PrintbmFont</span>(bmBuf);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;----------------------</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>執行上述範例程式，輸出將包含原始 UTF-8 字串、每個字元對應的 Big5 編碼值，以及每個字元在終端機上的點陣視覺化呈現。開發者可以透過修改 <code>text</code> 變數的值測試不同的字元組合，驗證轉換邏輯的正確性。</p><h2 id=技術特性與限制>技術特性與限制</h2><p>本程式在設計上具有以下技術特性值得注意。首先，程式完全基於標準 C 函式庫實作，不依賴任何特定平台的功能，因此具有良好的可攜性，可在 Windows、Linux、macOS 等各種作業系統上編譯執行。其次，核心轉換函式均經過記憶體安全的設計，所有指標參數在進入函式後都會進行有效性檢查，避免空指標存取導致的程式崩潰。</p><p>然而，程式也存在若干限制需要注意。目前程式僅支援 Big5 編碼標準中定義的常用字元區塊，對於某些罕用字元或擴充字元（如 Big5-2003 的新增字元）可能無法正確處理。此外，程式的字型資料來源假設為 <code>lili/bmFont.h</code> 中定義的特定格式（24x24 全形、16x24 半形），若實際使用的字型尺寸不同，需要相應調整 <code>#define</code> 巨集定義和 <code>GetBmfontBuf</code> 函式中的計算邏輯。</p><p>另一個潛在的限制是記憶體使用量。<code>lili/big5_sort_table.h</code> 中的映射表可能佔用數百 KB 的記憶體，對於極度記憶體受限的嵌入式系統，可能需要考慮使用更精簡的映射方式（如雜湊表或字典樹）。在這種情況下，可以保留 <code>utf8_to_big5</code> 和 <code>next_utf8_codepoint</code> 函式作為輸入解析層，僅替換 <code>lookup_big5</code> 的實作方式。</p><h2 id=未來擴展方向>未來擴展方向</h2><p>基於本程式的現有架構，以下擴展方向可作為未來開發的參考。第一，可擴充編碼支援，透過新增對 GB2312、GBK、Shift-JIS 等東亞編碼的轉換邏輯，使程式能夠處理更多語言的文字。第二，可實作字型快取機制，對於重複出現的字元保存已查詢的點陣資料，避免重複的記憶體複製操作，提升顯示更新效率。第三，可增加字型尺寸的動態支援，允許在執行階段指定輸出點陣的解析度，透過上採樣或下採樣的方式調整字型大小。第四，可與圖形庫整合，如將輸出改為Framebuffer格式或直接寫入顯示驅動程式，使其能夠直接控制實際的顯示硬體。</p><p><a href=https://codeberg.org/SoaB/bmFont.git>源碼在這裏</a></p><div class=blog-tags><a href=https://soab.github.io/tags/c-big5-utf8-bmpfont/>c big5 utf8 bmpfont</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fsoab.github.io%2fposts%2f2026-01-17%2f&amp;text=UTF8%20To%20BIG5%20%2b%20bmfont&amp;via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fsoab.github.io%2fposts%2f2026-01-17%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fsoab.github.io%2fposts%2f2026-01-17%2f&amp;title=UTF8%20To%20BIG5%20%2b%20bmfont" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fsoab.github.io%2fposts%2f2026-01-17%2f&amp;title=UTF8%20To%20BIG5%20%2b%20bmfont" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fsoab.github.io%2fposts%2f2026-01-17%2f&amp;title=UTF8%20To%20BIG5%20%2b%20bmfont" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fsoab.github.io%2fposts%2f2026-01-17%2f&amp;description=UTF8%20To%20BIG5%20%2b%20bmfont" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://soab.github.io/posts/2026-01-13/ data-toggle=tooltip data-placement=top title="Code - Mine Sweeper">&larr; Previous Post</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2026
&nbsp;&bull;&nbsp;
<a href=https://soab.github.io/>SoaB</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.154.5</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://soab.github.io/js/main.js></script><script src=https://soab.github.io/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://soab.github.io/js/load-photoswipe.js></script></body></html>